<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Giulio Bellini">

<title>Bankruptcy Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Bankruptcy Prediction_files/libs/clipboard/clipboard.min.js"></script>
<script src="Bankruptcy Prediction_files/libs/quarto-html/quarto.js"></script>
<script src="Bankruptcy Prediction_files/libs/quarto-html/popper.min.js"></script>
<script src="Bankruptcy Prediction_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Bankruptcy Prediction_files/libs/quarto-html/anchor.min.js"></script>
<link href="Bankruptcy Prediction_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Bankruptcy Prediction_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Bankruptcy Prediction_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Bankruptcy Prediction_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Bankruptcy Prediction_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Bankruptcy Prediction_files/libs/htmlwidgets-1.6.0/htmlwidgets.js"></script>
<link href="Bankruptcy Prediction_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Bankruptcy Prediction_files/libs/datatables-binding-0.32/datatables.js"></script>
<script src="Bankruptcy Prediction_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="Bankruptcy Prediction_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Bankruptcy Prediction_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Bankruptcy Prediction_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="Bankruptcy Prediction_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="Bankruptcy Prediction_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bankruptcy Prediction</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Giulio Bellini </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<div class="cell">

</div>
<section id="data-handling" class="level3">
<h3 class="anchored" data-anchor-id="data-handling">Data Handling</h3>
<p>A first step in the exploration analysis, we load the data from the workplace and convert it into a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())  <span class="co">#clear environment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">read_excel</span>(<span class="st">"data.xlsx"</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#View(df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the dimensions of the dataset, we can see that it contains 6819 samples (companies) , 95 independent variables and 1 dependent variable. The features are all numerical and represent accounting values and ratios of the company to which they refer. The purpose of this research is to see whether the variables and the interactions between them can accurately predict the target variable, i.e.&nbsp;whether the company has gone bankrupt (Y=1) or not (Y=0).</p>
<p>The target variable is highly imbalanced, with only 220 bankruptcy cases, representing 3.2% of the total.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>The dimensions of the dataset is: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>6819 96 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The distribution of the target variable is: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>6599 220 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The proportion of positiove cases is: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.032</code></pre>
</div>
</div>
<p>The table below shows three main descriptive statistics (type, mean, standard deviation and number of missing values) for the dependent variable and each of the independent variables.</p>
<p>All variables are numeric. This is an advantage for modelling as there is no need to encode categorical variables. Furthermore, there are no missing values in the dataset, so there is no need to impute values in the data handling phase.</p>
<p>A closer look at the table shows that some variables have very small standard deviations. This means that the companies under consideration have very similar values for these variables or that the classes are highly imbalance.</p>
<p>Finally, the variable <em>“Net Income Flag”</em> has a standard deviation equal to 0, as it takes the value 1 for all samples (all companies have negative net income for the last two years). This variable does not help in classification and must be removed as it causes errors in the calculation of correlations, PCA, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate descriptive statistics</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to calculate mean for numeric columns only</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>mean_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to calculate standard deviation for numeric columns only</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>sd_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)) <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the statistics</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Feature = names(df),</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">DataType =</span> <span class="fu">sapply</span>(df, class),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">sapply</span>(df, mean_numeric),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">StdDev =</span> <span class="fu">sapply</span>(df, sd_numeric),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">NumMissing =</span> <span class="fu">sapply</span>(df, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a tibble for nicer printing, if desired</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(stats, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c951a1853e95dcb12225" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c951a1853e95dcb12225">{"x":{"filter":"none","vertical":false,"data":[["Bankrupt?","ROA(C) before interest and depreciation before interest","ROA(A) before interest and % after tax","ROA(B) before interest and depreciation after tax","Operating Gross Margin","Realized Sales Gross Margin","Operating Profit Rate","Pre-tax net Interest Rate","After-tax net Interest Rate","Non-industry income and expenditure/revenue","Continuous interest rate (after tax)","Operating Expense Rate","Research and development expense rate","Cash flow rate","Interest-bearing debt interest rate","Tax rate (A)","Net Value Per Share (B)","Net Value Per Share (A)","Net Value Per Share (C)","Persistent EPS in the Last Four Seasons","Cash Flow Per Share","Revenue Per Share (Yuan Â¥)","Operating Profit Per Share (Yuan Â¥)","Per Share Net profit before tax (Yuan Â¥)","Realized Sales Gross Profit Growth Rate","Operating Profit Growth Rate","After-tax Net Profit Growth Rate","Regular Net Profit Growth Rate","Continuous Net Profit Growth Rate","Total Asset Growth Rate","Net Value Growth Rate","Total Asset Return Growth Rate Ratio","Cash Reinvestment %","Current Ratio","Quick Ratio","Interest Expense Ratio","Total debt/Total net worth","Debt ratio %","Net worth/Assets","Long-term fund suitability ratio (A)","Borrowing dependency","Contingent liabilities/Net worth","Operating profit/Paid-in capital","Net profit before tax/Paid-in capital","Inventory and accounts receivable/Net value","Total Asset Turnover","Accounts Receivable Turnover","Average Collection Days","Inventory Turnover Rate (times)","Fixed Assets Turnover Frequency","Net Worth Turnover Rate (times)","Revenue per person","Operating profit per person","Allocation rate per person","Working Capital to Total Assets","Quick Assets/Total Assets","Current Assets/Total Assets","Cash/Total Assets","Quick Assets/Current Liability","Cash/Current Liability","Current Liability to Assets","Operating Funds to Liability","Inventory/Working Capital","Inventory/Current Liability","Current Liabilities/Liability","Working Capital/Equity","Current Liabilities/Equity","Long-term Liability to Current Assets","Retained Earnings to Total Assets","Total income/Total expense","Total expense/Assets","Current Asset Turnover Rate","Quick Asset Turnover Rate","Working capitcal Turnover Rate","Cash Turnover Rate","Cash Flow to Sales","Fixed Assets to Assets","Current Liability to Liability","Current Liability to Equity","Equity to Long-term Liability","Cash Flow to Total Assets","Cash Flow to Liability","CFO to Assets","Cash Flow to Equity","Current Liability to Current Assets","Liability-Assets Flag","Net Income to Total Assets","Total assets to GNP price","No-credit Interval","Gross Profit to Sales","Net Income to Stockholder's Equity","Liability to Equity","Degree of Financial Leverage (DFL)","Interest Coverage Ratio (Interest expense to EBIT)","Net Income Flag","Equity to Liability"],["numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric","numeric"],[0.0322627951312509,0.505179633241782,0.558624915875046,0.553588709351666,0.607948038370384,0.607929469176979,0.998755127790044,0.79718975247129,0.809083593513535,0.303622923649734,0.781381432526142,1995347312.80289,1950427306.05683,0.467431185779661,16448012.9059425,0.115000747941424,0.190660579497474,0.190633178967746,0.190672370253162,0.228812852564528,0.323481912169832,1328640.60209607,0.109090738875469,0.184360577642033,0.0224078544741659,0.847979995168808,0.689146118568132,0.689150011779562,0.217639012996967,5508096595.24875,1566212.05524107,0.264247511875841,0.379676672322662,403284.954244977,8376594.81968489,0.630991011712421,4416336.71425936,0.11317708497306,0.88682291502694,0.00878273381503683,0.374654294598723,0.00596827726647909,0.108976681403385,0.182715029076736,0.402459330520669,0.14160561602173,12789705.2375536,9826220.86119159,2149106056.60762,1008595981.81752,0.0385950546149516,2325854.26635828,0.400671015081335,11255785.3217421,0.814125170261333,0.400131812365057,0.522273446768034,0.124094560489652,3592902.19682965,37159994.1471333,0.0906727945676238,0.353828004121587,0.277395106102332,55806804.5257796,0.761598877585333,0.735816525732218,0.331409800616988,54160038.1358944,0.934732754127004,0.00254894556738646,0.0291840992558606,1195855763.30894,2163735272.03443,0.594006265565916,2471976967.44432,0.67153078109921,1220120.50158955,0.761598877585333,0.331409800616988,0.115644651496369,0.649730590179236,0.461849253292257,0.593415086109621,0.315582389899575,0.0315063657474407,0.00117319255022731,0.807760220036549,18629417.811836,0.623914574767534,0.607946340270717,0.8404020646301,0.280365153833393,0.0275411194212036,0.565357933546557,1,0.0475783565294976],[0.17671017660774,0.0606856387542844,0.0656200310317073,0.0615948092918757,0.0169338125482215,0.0169160700556758,0.0130100250929841,0.0128689884198846,0.013600653945149,0.0111634398381285,0.0126790040289132,3237683890.52238,2598291553.99832,0.0170355173087854,108275033.532824,0.138667496728351,0.033389768351331,0.033473514172429,0.0334801376704091,0.0332626130759769,0.0176109129583438,51707089.7679066,0.0279422447744161,0.0331802089809054,0.0120792701529116,0.0107524774054014,0.0138530222609348,0.0139102834140106,0.0100629631461161,2897717771.1697,114159389.518346,0.00963420886261161,0.0207365658096168,33302155.8254802,244684748.446872,0.0112384615040502,168406905.281511,0.0539203060630828,0.0539203060630828,0.0281529260492906,0.0162861633555004,0.0121883618758573,0.0277816859856405,0.0307847715083098,0.0133240795879323,0.101144968492923,278259836.984067,256358895.705332,3247967014.04781,2477557316.92015,0.0366803435604136,136632654.389936,0.0327201441946995,294506294.116771,0.0590544026482635,0.201998066680682,0.218111821514193,0.139250583583326,171620908.606822,510350903.162731,0.0502898566689182,0.0351471841791881,0.0104688469729452,582051554.619419,0.206676767683442,0.0116780264755991,0.0134880279088979,570270621.95921,0.0255642216906431,0.012092814696218,0.0271487767928616,2821161238.26231,3374944402.16602,0.00895938417892221,2938623226.67884,0.0093413456183006,100754158.713168,0.206676767683442,0.0134880279088979,0.0195291762753142,0.047372131914505,0.0299426803452448,0.0585605501422486,0.0129608924016473,0.0308446884535638,0.0342343108653021,0.0403321915314262,376450059.745822,0.0122895480074123,0.0169338077956736,0.0145225260825249,0.014463223575594,0.0156679418664297,0.0132142397619619,0,0.050013716180138],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>DataType<\/th>\n      <th>Mean<\/th>\n      <th>StdDev<\/th>\n      <th>NumMissing<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"DataType","targets":1},{"name":"Mean","targets":2},{"name":"StdDev","targets":3},{"name":"NumMissing","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Removing zero variance variable "Net Income Flag"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, <span class="at">select=</span> <span class="sc">-</span><span class="st">`</span><span class="at">Net Income Flag</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">Inventory Turnover Rate (times)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Bankruptcy-Prediction_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "original_names &lt;- colnames(df)\nmodified_names &lt;- list()\n\nfor (index in seq(length(colnames(df)))) {\n  if (index == 1) {\n    modified_names &lt;- c(modified_names, 'Y')\n  }\n  else {\n    modified_names &lt;- c(modified_names, paste0('X',as.character(index-1)))\n  }\n  \n}\n\ncolnames(df) &lt;- modified_names\n"</code></pre>
</div>
</div>
<p>A key step is to divide the data into two sets: the training set and the test set.</p>
<ul>
<li><p>The <strong><em>training set</em></strong> will be used for correlation analysis, multicollinearity testing, dimensionality reduction, selecting the method for generating synthetic data, and training the classification models.</p></li>
<li><p>The <strong><em>test set</em></strong> is used to approximate the performance of the models on out-of-sample data.</p></li>
</ul>
<p>It is important to separate the training and test sets before performing any data transformation, analysis or modelling to avoid data leakage between the test and training sets, which could lead to a positive bias (overestimation) in model performance.</p>
<p>The <em>X_train</em> and <em>X_test</em> sets are then scaled separately to avoid information leakage. Scaling the features so that they have a mean of 0 and a standard deviation of 1 is an important step because some algorithms are affected by the order of magnitude of the variables.</p>
<p>For example, in <strong>Principal Component Analysis</strong> (PCA), if a feature has a larger variance just because of its order of magnitude, it will have a larger effect on the direction of the principal component without any real motivation, leading to worse class separability in lower dimensions.</p>
<p>Another example is the <strong>K-Nearest Neighbours</strong> (KNN) algorithm, which is used both as a classification model and in other algorithms such as Isomap and SMOTE. In KNN, the use of unscaled features results in a completely different fit, as higher order variables have a greater impact on the distance between data points and thus on the selection of the k-nearest neighbours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a stratified random sample to maintain proportion of target variable</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># Set seed for reproducibility</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(df<span class="sc">$</span><span class="st">`</span><span class="at">Bankrupt?</span><span class="st">`</span>, <span class="at">p =</span> <span class="fl">0.8</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Split independent and dependent variables</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale sets separately to avoid data leakage</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(<span class="fu">select</span>(df[trainIndex, ], <span class="sc">-</span><span class="st">`</span><span class="at">Bankrupt?</span><span class="st">`</span>)))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> df[trainIndex, ]<span class="sc">$</span><span class="st">`</span><span class="at">Bankrupt?</span><span class="st">`</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(<span class="fu">select</span>(df[<span class="sc">-</span>trainIndex, ], <span class="sc">-</span><span class="st">`</span><span class="at">Bankrupt?</span><span class="st">`</span>)))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> df[<span class="sc">-</span>trainIndex, ]<span class="sc">$</span><span class="st">`</span><span class="at">Bankrupt?</span><span class="st">`</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, train set contains 80% of the data, and test set contains 20%, </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># with the proportion of the target variable's classes maintained.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-analysis" class="level3">
<h3 class="anchored" data-anchor-id="correlation-analysis">Correlation Analysis</h3>
<p>The Table below show the <strong>correlation</strong> of each independent variable with the dependent variable “Bankrupt?”.</p>
<p>In the graph on the right, the features are sorted in descending order according to their correlation coefficient with the independent variable.</p>
<p>It can be seen that variables related to the amount of liabilities relative to equity and assets are <em>positively</em> correlated with corporate bankruptcy. This makes sense from a financial point of view, since excessive use of debt, especially short-term debt, increases the risk of insolvency. Excessive expenses relative to asset value and excessive reliance on equity relative to long-term debt are also positively correlated with bankruptcy.</p>
<p>Variables related to profit, efficiency, such as ROA (return on assets) and share value are <em>negatively</em> correlated with company failure. Again, this makes financial sense. A company with high profitability is able to pay its debts on time, make investments for growth and face sudden expenses without running the risk of financial distress.</p>
<p>The correlation coefficients of the independent variables are mostly below 0.3 in absolute terms. Therefore, the features are only weakly positively correlated with the dependent variable. This is a common occurrence in economics and finance, as many factors affect the economic system. However, this does not necessarily mean that these variables and their interactions lack predictive power.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perforing Pearson Correlation Test on the Training Set</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining empty dataframe to store the results: corr coefficients and p-values</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate along the columns and compute correlation coefficent and p-value for each independent variable with the dependent variable</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(X_train) <span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(Y_train, X_train[, col])</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  result_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">index=</span><span class="fu">colnames</span>(X_train)[col], <span class="at">coeff=</span><span class="fu">round</span>(result<span class="sc">$</span>estimate,<span class="dv">4</span>), <span class="at">pvalue=</span><span class="fu">round</span>(result<span class="sc">$</span>p.value, <span class="dv">5</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  test_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(test_results, result_df)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting features names as row names</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(test_results) <span class="ot">&lt;-</span> test_results<span class="sc">$</span>index</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>index <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating interactive table to visualize the results</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Features are sorted in descending order based on the correlation coefficient</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(test_results[<span class="fu">order</span>(<span class="sc">-</span>test_results<span class="sc">$</span>coeff),], <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-13ca0595e3823bdd1094" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13ca0595e3823bdd1094">{"x":{"filter":"none","vertical":false,"data":[["Debt ratio %","Current Liability to Current Assets","Current Liability to Assets","Liability-Assets Flag","Borrowing dependency","Liability to Equity","Total expense/Assets","Current Liabilities/Equity","Current Liability to Equity","Equity to Long-term Liability","Fixed Assets Turnover Frequency","Cash/Current Liability","Net Value Growth Rate","Fixed Assets to Assets","Inventory and accounts receivable/Net value","Total assets to GNP price","Contingent liabilities/Net worth","Quick Ratio","Quick Asset Turnover Rate","Long-term fund suitability ratio (A)","Degree of Financial Leverage (DFL)","Current Asset Turnover Rate","Net Worth Turnover Rate (times)","Inventory Turnover Rate (times)","Long-term Liability to Current Assets","Allocation rate per person","Cash Flow to Sales","Realized Sales Gross Profit Growth Rate","Operating Profit Rate","Inventory/Working Capital","Working capitcal Turnover Rate","Revenue per person","Quick Assets/Current Liability","Total debt/Total net worth","Revenue Per Share (Yuan Â¥)","After-tax net Interest Rate","Interest Coverage Ratio (Interest expense to EBIT)","Continuous interest rate (after tax)","Operating Expense Rate","Pre-tax net Interest Rate","Average Collection Days","Total income/Total expense","Accounts Receivable Turnover","No-credit Interval","Continuous Net Profit Growth Rate","Non-industry income and expenditure/revenue","Inventory/Current Liability","Operating Profit Growth Rate","Interest Expense Ratio","Total Asset Return Growth Rate Ratio","Cash Turnover Rate","Interest-bearing debt interest rate","Research and development expense rate","Current Liabilities/Liability","Current Liability to Liability","Cash Flow to Equity","Regular Net Profit Growth Rate","After-tax Net Profit Growth Rate","Cash Flow to Liability","Total Asset Growth Rate","Cash Reinvestment %","Current Assets/Total Assets","Cash Flow to Total Assets","Cash Flow Per Share","Current Ratio","Total Asset Turnover","Cash flow rate","Operating Funds to Liability","Operating profit per person","Cash/Total Assets","Quick Assets/Total Assets","Tax rate (A)","CFO to Assets","Realized Sales Gross Margin","Operating Gross Margin","Gross Profit to Sales","Operating profit/Paid-in capital","Operating Profit Per Share (Yuan Â¥)","Net Income to Stockholder's Equity","Working Capital/Equity","Net Value Per Share (C)","Net Value Per Share (B)","Net Value Per Share (A)","Working Capital to Total Assets","Per Share Net profit before tax (Yuan Â¥)","Net profit before tax/Paid-in capital","Retained Earnings to Total Assets","Persistent EPS in the Last Four Seasons","Net worth/Assets","ROA(C) before interest and depreciation before interest","ROA(B) before interest and depreciation after tax","ROA(A) before interest and % after tax","Net Income to Total Assets"],[0.2508,0.2061,0.1887,0.1649,0.1605,0.1541,0.1462,0.1354,0.1354,0.127,0.0772,0.076,0.0731,0.0731,0.059,0.0402,0.0347,0.0294,0.0292,0.0203,0.012,0.0116,0.0107,0.0052,0.0048,0.0043,0.0012,0.0004,0.0002,-0.0004,-0.0004,-0.0025,-0.0025,-0.0034,-0.0041,-0.0055,-0.0056,-0.0063,-0.0063,-0.0066,-0.007,-0.007,-0.0086,-0.0093,-0.0094,-0.0155,-0.0157,-0.0161,-0.0161,-0.0162,-0.0174,-0.0221,-0.0235,-0.0298,-0.0298,-0.0353,-0.0361,-0.0371,-0.0374,-0.0443,-0.0448,-0.06,-0.0689,-0.0768,-0.0822,-0.0833,-0.0835,-0.0862,-0.0937,-0.098,-0.099,-0.1106,-0.1161,-0.1174,-0.1181,-0.1181,-0.1487,-0.1496,-0.1661,-0.167,-0.1677,-0.168,-0.1681,-0.2035,-0.2122,-0.2169,-0.2242,-0.2251,-0.2508,-0.2652,-0.2795,-0.2928,-0.3293],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-05,0.00298,0.01033,0.02987,0.03088,0.13311,0.37602,0.39247,0.43155,0.70157,0.72414,0.74846,0.92711,0.97789,0.98548,0.97937,0.97874,0.85306,0.85306,0.79952,0.76227,0.6864,0.67832,0.64358,0.64051,0.62403,0.60365,0.60657,0.52298,0.49395,0.48854,0.25273,0.24754,0.23393,0.23439,0.23248,0.19784,0.10316,0.08323,0.02796,0.02796,0.00904,0.00765,0.00607,0.00575,0.00105,0.00094,1e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>coeff<\/th>\n      <th>pvalue<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"coeff","targets":1},{"name":"pvalue","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Figure shows the correlation matrix of the independent variables. The names of the variables have been omitted to avoid cluttering the graph. The Figure shows the correlation matrix of the variables that have a correlation coefficient greater than or equal to 0.9 in absolute terms with any other independent variable.</p>
<p>In both correlation matrices, the variables were rearranged using hierarchical clustering to identify possible clusters of highly correlated variables. Hierarchical clustering was applied to the distance matrix obtained from the correlation matrix, where distances were calculated as <span class="math inline">\(1 - |correlationCoeff|\)</span>. The features were then reordered so that variables belonging to the same cluster were positioned next to each other in the matrix. This procedure makes the correlation matrix easier to interpret.</p>
<p>In Figure we can see two main clusters: one of positively correlated features in the centre of the plot and one of negatively correlated features at the top. Other smaller clusters are also visible. Looking at Figure, these two clusters are even more obvious.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mfrow = c(1, 2))</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(X_train)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Y_cor <span class="ot">&lt;-</span><span class="fu">cor</span>(X_train, Y_train, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>index_order <span class="ot">&lt;-</span> <span class="fu">order</span>(Y_cor, <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>Y_cor_sorted <span class="ot">&lt;-</span> Y_cor[index_order]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>Y_cor_sorted_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(Y_cor)[index_order]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>Y_cor_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Y_cor_sorted, <span class="at">nrow =</span> <span class="fu">length</span>(Y_cor_sorted), <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(Y_cor_sorted_names, <span class="fu">c</span>(<span class="st">"Bankrupt?"</span>)))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust plot size</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#options(repr.plot.width=14, repr.plot.height=30)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot correlation matrix</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mar=c(2,2,2,2))  # Adjust margin to fit long variable names</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>))(<span class="dv">200</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#corrplot(Y_cor_matrix, is.corr = FALSE, method = "color",</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>       <span class="co">#tl.col = "black", col=col, tl.cex = 0.6, tl.srt=0, cl.pos="n")</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.pos =</span> <span class="st">"n"</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="co"># Exclude diagonal</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="co"># Order variables by hierarchical clustering</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co"># Set text label color</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>         <span class="co">#tl.cex = 0,</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span>col)<span class="co"># Adjust text label size </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Bankruptcy-Prediction_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#title("Correlation Matrix")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some features are perfectly correlated:</p>
<p><span class="math inline">\(Corr(Current\ Liability\ to\ Equity,\ Current\ Liabilities/Equity) = 1\)</span></p>
<p><span class="math inline">\(Corr(Current\ Liabilities\ to\ Liability,\ Current\ Liabilities/Liability) = 1\)</span></p>
<p><span class="math inline">\(Corr(Debt\ Ratio, Net\ Worth/Assets) = -1\)</span></p>
<p>These variables seem to measure the same quantity, even if their names are slightly different. For each pair of perfectly correlated variables, it is necessary to select only one, as the other would complicate the models without providing any useful information.</p>
<p>Other variables are highly correlated, even if not perfectly. These variables express very similar accounting aspects, differing only in small details. Some examples are:</p>
<p><span class="math inline">\(Corr(Operating\ Gross\ Margin,\ Gross\ Profit\ to\ Sales) = 0.999\)</span></p>
<p><span class="math inline">\(Corr(Pre-tax\ net\ Interest\ Rate,\ After-tax\ net\ Interest\ Rate) = 0.987\)</span></p>
<p><span class="math inline">\(Corr(ROA(A)\ before\ interest,\ Net\ Income\ to\ Total\ Assets) = 0.96\)</span></p>
<p>Unlike in the case of perfectly correlated variables, in this case it is not the best choice to choose one random variable to keep and disregard the other, because we may miss important information, such as interactions with other variables. It is therefore necessary to proceed with further analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify features with correlation &gt; 0.9 or &lt; -0.9 with any other feature</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude diagonal elements by setting them to 0 as we don't consider self-correlation</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(cor_matrix) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>high_cor_features <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">apply</span>(cor_matrix, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span> x <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.9</span>)), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the correlation matrix</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>sub_cor_matrix <span class="ot">&lt;-</span> cor_matrix[high_cor_features, high_cor_features]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom color sequence from blue to red</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>))(<span class="dv">200</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the subsetted correlation matrix</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#par(mar = c(0,0, 0, 0))</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#options(repr.plot.width=2, repr.plot.height=3)</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(sub_cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type=</span><span class="st">"upper"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="co"># Cluster variables</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">addrect =</span> <span class="dv">3</span>, <span class="co"># Adjust the number of rectangles for clustering as needed</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag=</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">tl.cex =</span> <span class="fl">0.7</span>, <span class="co"># Adjust text appearance</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> col) <span class="co"># Use the custom color sequence</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Bankruptcy-Prediction_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="1440"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#title("Subset Correlation Matrix")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dimensionality-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimensionality-reduction">Dimensionality Reduction</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(X_train) <span class="co">#, scale. = TRUE</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the first two principal components</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>pc1 <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>x[, <span class="dv">1</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>pc2 <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>x[, <span class="dv">2</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe for plotting</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>pca_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC1 =</span> pc1, <span class="at">PC2 =</span> pc2, <span class="at">Y=</span><span class="fu">factor</span>(Y_train, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non Bankrupt"</span>, <span class="st">"Bankrupt"</span>)))</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the first two principal components</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_df, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color=</span>Y)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Principal Component 1"</span>, <span class="at">y =</span> <span class="st">"Principal Component 2"</span>, <span class="at">color=</span><span class="st">'Y'</span>,<span class="at">title =</span> <span class="st">"PCA: First Two Principal Components"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Bankruptcy-Prediction_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># warning: false</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rtsne)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform t-SNE</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>tsne_result <span class="ot">&lt;-</span> <span class="fu">Rtsne</span>(X_train)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>tsne_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tsne_result<span class="sc">$</span>Y, <span class="at">Y=</span> <span class="fu">factor</span>(Y_train, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non Bankrupt"</span>, <span class="st">"Bankrupt"</span>)))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot t-SNE result</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tsne_df, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">color =</span> Y)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"t-SNE Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Bankruptcy-Prediction_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Exporting train and test sets</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(openxlsx)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#write.xlsx(trainSet, file = "train.xlsx", sheetName = "train", rowNames = FALSE)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#write.xlsx(testSet, file = "test.xlsx", sheetName = "test", rowNames = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>